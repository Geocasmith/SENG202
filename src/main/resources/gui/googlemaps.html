<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0px; padding: 0px }
        #map_canvas { height: 100%; background-color: #666970; }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW-d_-W5qGFc9RBlZuvA0UyyimTnuKUfE&callback=initMap"></script>
    <script type="text/javascript">
        var map;
        var marker;
        var markers = [];
        var infowindow = null;
        var polyline = new google.maps.Polyline();;
        var latlngbounds = new google.maps.LatLngBounds();
        function initialize() {
            var latlng = new google.maps.LatLng(41.85001, -87.6782);
            var myOptions = {
                zoom: 10,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false,
                navigationControl: false,
                streetViewControl: false,
                backgroundColor: "#666970"
            };

            document.geocoder = new google.maps.Geocoder();
            map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
        }

        // Receives information about a crime record, plots it on the map and creates in infowindow that opens when the marker is clicked
        document.plotPoint = function plotPoint(record) {

            // Format content for an infowindow
            var infoWindowContent = "<h1 style='font-size:200%;'>" + record[2] + "</h1>" +
                "<p>" + "Date and Time: " + record[3] + "<br />" + "<br />" +
                "Primary Description: " + record[4] + "<br />" + "<br />" +
                "Secondary Description: " + record[5] + "<br />" + "<br />" +
                "Location Description: " + record[6] + "<br />" +
                "</p>";

            var markerPosition = new google.maps.LatLng(record[0], record[1])
            // Create a new marker at the given position
            marker = new google.maps.Marker({
                position: markerPosition,
                map: map,
                'optimized': true
            });

            // Add a click event listener to the marker, and assign a new infowindow to open when the marker is clicked
            marker.addListener('click', function() {
                if (infowindow) infowindow.close();
                infowindow = new google.maps.InfoWindow({
                    content: infoWindowContent
                });
                infowindow.open(map, this)
            });

            // Add the marker to the list of markers
            markers.push(marker);
            latlngbounds.extend(markerPosition);
            map.fitBounds(latlngbounds);
        }

        // Delete all the markers on the map
        document.clearMap = function clearMap() {
            for (let i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            polyline.setMap(null);
            latlngbounds = new google.maps.LatLngBounds();

        }

        document.analysePoints = function analysePoints(record1, record2) {
            document.plotPoint(record1);
            document.plotPoint(record2);
            lineCoordinates = [
                new google.maps.LatLng(record1[0], record1[1]),
                new google.maps.LatLng(record2[0], record2[1])
            ];
            polyline = new google.maps.Polyline({
                path:lineCoordinates,
                geodesic: true,
                strokeColor: "#FF00F0",
                strokeOpacity: 1.0,
                strokeWeight: 2,
                map: map
            });
            for (var i = 0; i < lineCoordinates.length; i++) {
                latlngbounds.extend(lineCoordinates[i]);
            }
            map.fitBounds(latlngbounds);
        }

        document.setZoom = function setZoom(zoomLevel) {
            map.setZoom(zoomLevel)
        }

    </script>
</head>
<body onload="initialize()">
<div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>